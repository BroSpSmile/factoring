<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/layout">
<div layout:fragment="content">
    <div id="factoring" v-cloak>
        <row>
            <i-col span="24">
                <card dis-hover>
                    <p slot="title">{{detail.id?'项目明细':'新建项目'}}</p>
                    <p>
                        <i-form :label-width="140" ref="entityDataForm" :rules="validata" :model="detail">
                            <row>
                                <i-col span="8">
                                    <form-item label="项目编号" prop="project.projectId">
                                        <i-input placeholder="输入项目名称" v-model="detail.project.projectId"></i-input>
                                    </form-item>
                                </i-col>
                                <i-col span="14">
                                    <form-item label="项目名称" prop="project.projectName">
                                        <i-input placeholder="输入项目名称" v-model="detail.project.projectName"></i-input>
                                    </form-item>
                                </i-col>
                            </row>
                            <row>
                                <i-col span="11">
                                    <form-item label="债权人全称" prop="creditor">
                                        <i-input placeholder="输入债权人全称" v-model="detail.creditor"></i-input>
                                    </form-item>
                                </i-col>
                                <i-col span="11">
                                    <form-item label="债务人全称" prop="debtor">
                                        <i-input placeholder="输入债务人全称" v-model="detail.debtor"></i-input>
                                    </form-item>
                                </i-col>
                            </row>
                            <row>
                                <i-col span="22">
                                    <form-item label="基础合同" prop="baseContract">
                                        <i-input placeholder="输入基础合同" v-model="detail.baseContract"></i-input>
                                    </form-item>
                                </i-col>
                            </row>
                            <row>
                                <i-col span="8">
                                    <form-item label="追索权" prop="model">
                                        <radio-group v-model="detail.project.model">
                                            <radio label="RECOURSE_RIGHT">有追索权模式</radio>
                                            <radio label="DIS_RECOURSE_RIGHT">无追索权模式</radio>
                                        </radio-group>
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="申请日期" prop="signDate">
                                        <date-picker type="date" placeholder="请选择申请日期"
                                                     v-model="detail.project.createTime"></date-picker>
                                    </form-item>
                                </i-col>
                                <!--<i-col span="8">-->
                                <!--<form-item label="合同回款日" prop="remittanceDay">-->
                                <!--<date-picker type="date" placeholder="请选择合同回款日"-->
                                <!--v-model="detail.remittanceDay"></date-picker>-->
                                <!--</form-item>-->
                                <!--</i-col>-->
                            </row>
                            <row>
                                <i-col span="8">
                                    <form-item label="应收账款受让款金额" prop="assignee">
                                        <input-number placeholder="输入应收账款受让款金额" min="0" :max="100000000000" :step="0.01"
                                                      :formatter="formatter" :parser="parser" @on-blur="comRate"
                                                      class="select-width-140" v-model="detail.assignee"></input-number>&nbsp;(元)
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="应收账款金额" prop="receivable">
                                        <input-number placeholder="输入应收账款金额" min="0" :max="100000000000" :step="0.01"
                                                      :formatter="formatter" :parser="parser"
                                                      class="select-width-140"
                                                      v-model="detail.receivable"></input-number>&nbsp;(元)
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="本次投放金额" prop="dropAmount">
                                        <input-number placeholder="请输入本次投放金额" min="0" :max="100000000000" :step="0.01"
                                                      :formatter="formatter" :parser="parser"
                                                      class="select-width-140" @on-blur="comRate"
                                                      v-model="detail.dropAmount"></input-number>&nbsp;(元)
                                        <span v-if="showLater">+待定</span>
                                    </form-item>
                                </i-col>
                            </row>
                            <row>
                                <i-col span="8">
                                    <form-item label="转让期限(月)" prop="duration">
                                        <input-number placeholder="输入转让期限" min="1" max="100" precision="0"
                                                      v-model="detail.duration"></input-number>
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="融资比例" prop="returnRate">
                                        <input-number placeholder="输入融资比例"
                                                      v-model="detail.returnRate"></input-number>
                                        %
                                    </form-item>
                                </i-col>
                            </row>
                            <row>
                                <i-col span="22">
                                    <form-item label="备注" prop="">
                                        <i-input placeholder="输入备注" v-model="detail.remark"></i-input>
                                    </form-item>
                                </i-col>
                            </row>
                            <span v-if="detail.project.step== '4'">
                                <row>
                                <i-col span="8">
                                    <form-item label="本次投放金额" prop="dropAmount">
                                        <input-number placeholder="请输入本次投放金额" min="0" max="100000000000" :step="0.01"
                                                      :formatter="formatter" :parser="parser" active-change="false"
                                                      class="select-width-140" @on-blur="comRate"
                                                      v-model="detail.dropAmount"></input-number>&nbsp;(元)
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="签署日期" prop="signDate">
                                        <date-picker type="date" placeholder="请选择签署日期"
                                                     v-model="detail.signDate"></date-picker>
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="放款日" prop="loanDay">
                                        <date-picker type="date" placeholder="请选择放款日期"
                                                     v-model="detail.loanDay"></date-picker>
                                    </form-item>
                                </i-col>
                            </row>
                            <row>
                                <i-col span="8">
                                    <form-item label="合同到期日" prop="remittanceDay">
                                        <date-picker type="date" placeholder="请选择合同到期日"
                                                     v-model="detail.remittanceDay"></date-picker>
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="应收账款管理费" prop="receivableManager">
                                        <input-number placeholder="请输入应收账款管理费" min="0" :max="100000000000" :step="0.01"
                                                      :formatter="formatter" :parser="parser"
                                                      class="select-width-140" @on-blur="comRate"
                                                      v-model="detail.receivableManager"></input-number>&nbsp;(元)
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="年化利率" prop="yeatRate">
                                        <input-number placeholder="输入年化利率" v-model="detail.yearRate" min="0.00"
                                                      :max="10000.00" :step="0.01"></input-number>
                                        %
                                    </form-item>
                                </i-col>
                            </row>
                                <row>
                                <i-col span="8">
                                    <form-item label="合同回款日" prop="remittanceDay">
                                        <date-picker type="date" placeholder="合同回款日"
                                                     v-model="detail.remittanceDay" readOnly></date-picker>
                                    </form-item>
                                </i-col>
                                <i-col span="8">
                                    <form-item label="实际本金回款日" prop="realRemittanceDay">
                                        <date-picker type="date" placeholder="合同回款日"
                                                     v-model="detail.realRemittanceDay"></date-picker>
                                    </form-item>
                                </i-col>
                            </row>
                                <card v-for="(installment,index) in detail.returnInstallments" :key="index" title="回款明细"
                                      dis-hover>
                                <i-form>
                                    <row>
                                        <i-col span="6">
                                            <form-item label="合同回款日" prop="">
                                                <date-picker type="date" placeholder="每期回款日"
                                                             v-model="installment.installmentDate"></date-picker>
                                            </form-item>
                                        </i-col>
                                        <i-col span="6">
                                            <form-item label="每期利息" prop="">
                                                <input-number min="0" :max="100000000000"
                                                              :formatter="formatter" :parser="parser"
                                                              class="select-width-120" v-model="installment.amount"
                                                ></input-number>&nbsp;(元)
                                            </form-item>
                                        </i-col>
                                        <i-col span="6">
                                            <form-item label="实际回款日期" prop="">
                                                <date-picker type="date" placeholder="每期回款日"
                                                             v-model="installment.realInstallmentDate"></date-picker>
                                            </form-item>
                                        </i-col>
                                        <i-col span="6">
                                            <form-item label="实际回款金额" prop="">
                                                <input-number min="0" max="100000000000" active-change="false"
                                                              :formatter="formatter" :parser="parser"
                                                              class="select-width-120"
                                                              v-model="installment.realAmount"
                                                ></input-number>&nbsp;(元)
                                            </form-item>
                                        </i-col>
                                    </row>
                                    <row>
                                        <i-col span="8">&nbsp;&nbsp;
                                            <form-item label="收据附件:">
                                                <span v-for="item in installment.items">
                                                    <Tag size="small"
                                                         @click.native="downloadItem(item)" type="border" closable
                                                         color="primary"
                                                         @on-close="deleteFile(item)">
                                                        {{item.itemName}}
                                                    </Tag> &nbsp;
                                                </span>
                                            </form-item>
                                        </i-col>
                                    </row>
                                </i-form>
                            </card>
                                 <br>

                            </span>
                        </i-form>
                    </p>
                </card>
                <br>
                <card dis-hover>
                    <p slot="title">项目附件</p>
                    <p>
                        <i-form :label-width="140" v-if="!detail.project.id || detail.project.step== '0' ">
                            <row>
                                <i-col span="20">
                                    <form-item label="附件上传:">
                                        <Upload action="/file/upload" :on-success="uploadSuccess"
                                                :on-error="uploadError"
                                                :on-remove="removeFile">
                                            <i-button size="small" icon="ios-cloud-upload-outline">上传文件</i-button>
                                        </Upload>
                                    </form-item>
                                </i-col>
                            </row>
                        </i-form>
                        <i-form :label-width="140" v-if="items.length>0">
                            <row>
                                <i-col span="20">
                                    <form-item label="项目附件:">
                                        <row v-for="kitem in items">
                                            <Tag color="warning">{{kitem.key|toTypeName}}</Tag>
                                            <span v-for="item in kitem.value">
                                            <Tag v-if="item.itemKind == 'DOC' " size="small"
                                                 @click.native="downloadItem(item)" type="border" closable
                                                 color="primary"
                                                 @on-close="deleteFile(item)">
                                                {{item.itemName}}
                                            </Tag> &nbsp;
                                        </span>
                                        </row>
                                    </form-item>
                                </i-col>
                            </row>
                        </i-form>
                    </p>
                </card>
                <br>
                <card dis-hover>
                    <i-form :label-width="140">
                        <row>
                            <i-col offset="4">
                                <i-button type="success" v-if="!detail.project.id || detail.project.step== '0' "
                                          @click="submit">保存
                                </i-button>
                                <i-button type="primary" v-if="detail.project.step== '0' && detail.project.projectId"
                                          @click="apply">提交申请
                                </i-button>
                                <i-button type="warning" v-if="detail.project.step== '1' && showGetBack "
                                          @click="getBack">业务取回
                                </i-button>
                                <i-button type="error" v-if="detail.project.step== '1' " @click="returnBack">取消申请
                                </i-button>
                                <i-button type="warning" v-if="detail.project.step== '4' " @click="returnBack">取消归档
                                </i-button>
                                <i-button @click="back">返回</i-button>
                            </i-col>
                        </row>
                    </i-form>
                </card>
            </i-col>

        </row>
        <input th:value="${id}" id="projectId" style="display:none"></input>
    </div>
    <script src="js/project/factoring.js"></script>
</div>
</html>